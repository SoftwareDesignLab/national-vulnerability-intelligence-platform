<div
  class="nvip-content-container vuln-container col-12"
  ng-controller="VulnerabilityController as vulnCtrl"
  ng-init="getVulnInfo()"
>
  <div
    class="nvip-vuln-nav-btn-ctn col-12"
    ng-controller="SearchController as search"
  >
    <button
      class="nvip-button nvip-vuln-nav-btn"
      routerLink="/search"
    >
      <fa-icon [icon]="faAngleDoubleLeft" aria-hidden="true"></fa-icon>
      Back to Latest Search Results
    </button>
  </div>

  <div class="vuln-content">
    <div class="cve-search-panel">
      <p class="vuln-cve-number">{{ vuln.cveId }}</p>
      <!-- TODO: search bar functionality inside vuln? -->
      <input
        class="vuln-search-bar"
        type="text"
        ng-model="vulnSearch"
        ng-blur="searchFocusOut()"
        ng-keyup="searchVulns(vulnSearch)"
      />
    </div>

    <div class="vuln-tabbed-panel">
      <div class="vuln-tab-bar col-12">
        <button class="vuln-tab-button" (click)="openTab('vuln-description')">
          Description
        </button>
        <button class="vuln-tab-button" (click)="openTab('vuln-severity-tab')">
          CVSS Score
        </button>
        <button class="vuln-tab-button" (click)="openTab('vuln-products')">
          Affected Products
        </button>
        <button
          class="vuln-tab-button"
          (click)="openTab('vuln-characteristics')"
        >
          VDO Labels
        </button>
        <button class="vuln-tab-button" (click)="openTab('vuln-references')">
          Vulnerability Source
        </button>
      </div>
      <div class="vuln-panel">
        <div class="vuln-tab vuln-description">
          <p>{{ vuln.description }}</p>
          <table class="col-12">
            <tr>
              <td>
                <b>Published Date:</b> <br />
                {{ vuln.publishedDate }}
              </td>
              <td>
                <b>Last Modified Date:</b> <br />
                {{ vuln.lastModifiedDate }}
              </td>
              <td>
                <b>Exploit Published Date:</b><br />
                {{ vuln.exploitPublishDate == "NA" ? "N/A" : vuln.exploitPublishDate }}
              </td>
            </tr>
            <tr>
              <td>
                <b>Patch:</b><br />
                <a href="{{ vuln.patch }}" target="_blank" *ngIf="vuln.patch && vuln.patch !== 'N/A'">Source</a>
                <span *ngIf="!vuln.patch || vuln.patch == 'N/A'">N/A</span>
              </td>
              <td>
                <b>Status:</b><br />
                {{ vuln.status }}
              </td>
              <td>
                <b>Exploit:</b><br />
                <a href="{{ vuln.exploitUrl }}" target="_blank" *ngIf="vuln.exploitUrl && vuln.exploitUrl !== 'NA'">Source</a>
                <span *ngIf="!vuln.exploitUrl || vuln.exploitUrl == 'NA'">N/A</span>
              </td>
            </tr>
            <tr>
              <td>
                <b>Fixed Date:</b><br />
                {{ vuln.fixDate }}
              </td>
              <td>
                <b>Type: </b><br />
                {{ vuln.type }}
              </td>
              <td>
                <b>Related Product: </b><br />
                {{ vuln.domain }}
              </td>
            </tr>
          </table>
          <br />
          <div
            id="divBtnOpenForReview"
            style="justify-content: center; align-items: center; display: none"
          >
            <!-- <a ng-href="#review/?cveid={{vuln.cveId}}" style="color: black; font-weight: bold;">Open For Review</a> -->
          </div>
        </div>
        <div class="vuln-tab vuln-severity-tab" *ngFor="let cvssScore of vuln.cvssScoreList;">
          <cvss-gauge [cvssScore]="cvssScore"></cvss-gauge>
        </div>
        <div class="vuln-tab vuln-products">
          <p>Affected Common Platform Enumeration (CPE) Item(s)</p>

          <div
            class="vuln-reference-link"
            *ngFor="let cpe of vuln.cpes"
          >
            <a href="https://nvd.nist.gov/products/cpe/search/results?namingFormat=2.3&keyword={{cpe}}" target="_blank">{{cpe}}</a>
          </div>
        </div>
        <div class="vuln-tab vuln-characteristics">
          <div>
            Predicted Vulnerability Description Ontology (VDO) Labels and
            Confidences
          </div>
          <div class="vuln-characteristics-graph-container">
            <div class="vuln-characteristics-graph" *ngFor="let vdo of sortVdoList();">
              <div class="vuln-characteristics-bar">
                <p>{{vdo.vdoNounGroup}} : {{vdo.vdoLabel}}</p>
                <p>{{(vdo.vdoConfidence * 100).toFixed(2)}}%</p>
              </div>
            </div>
          </div>
        </div>
        <div class="vuln-tab vuln-references">
          <p>The source(s) where the vulnerability was found</p>
          <div
            class="vuln-reference-link"
            *ngFor="let vulnRef of vuln.sources"
          >
            <a href="{{vulnRef}}" target="_blank">{{vulnRef}}</a>
          </div>
        </div>
        <div
          id="listProgressCircle"
          style="
            width: 100%;
            height: 100%;
            position: absolute;
            top: 30%;
            left: 40%;
          "
          [hidden]="!loading"
        >
          <fa-icon
            [icon]="faSpinner"
            animation="spin"
            size="3x"
            [fixedWidth]="true"
            [ngStyle]="{ color: 'black' }"
          ></fa-icon>
          <span>Loading...</span>
        </div>
      </div>
    </div>
  </div>
</div>
