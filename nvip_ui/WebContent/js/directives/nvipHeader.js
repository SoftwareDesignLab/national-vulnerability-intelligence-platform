/**
 * 
 */
app.directive('nvipHeader', function() {
	
	 return {
		 link: function (scope, elem, attrs) {
			
		 },
		 restrict: "E",
		 scope: {
		 },
		 template: 
		 `<div class="nvip-header col-12" ng-controller="LoginController as LoginCtrl">
		 	<div class="nvip-logo-container">
				<a href="#/" class="nvip-logo">
					<img src="images/nvip-simple-logo.jpg" alt="NVIP">
				</a>
			</div>
			<div class="nvip-header-container">
				<div id="userView"  class="nvip-header-links col-10" style="display:flex;">
					<div class="nvip-header-link col-4">
						<a href="#about/">About NVIP</a>
					</div>
					<div class="nvip-header-link col-4">
						<a href="#">Recent Vulnerabilities</a>
					</div>
					<div class="nvip-header-link col-4">
						<a href="#search/">Search</a>
					</div>
				</div>
				<div id="adminView" class="nvip-header-links col-10" style="display:none;">				
					<div class="nvip-header-link col-3">
						<a href="#about/">About NVIP</a>
					</div>
					<div class="nvip-header-link col-3">
						<a href="#">Recent Vulnerabilities</a>
					</div>
					<div class="nvip-header-link col-3">
						<a href="#search/">Search</a>
					</div>
					<div class="nvip-header-link col-3">
						<a href="#review/">Review</a>
					</div>
				</div>
				<div class="nvip-header-user-icon-container col-2">
					<a class="nvip-header-user-icon fa fa-sign-out" ng-hide="!isLoggedIn()" aria-hidden="true" ng-click="logOut()" href="#"></a>
					<p class="nvip-user-label" ng-hide="!isLoggedIn()">Welcome, {{getFirstName()}} </p>
					
					<button class="login-button nvip-user-label" onclick="openLogin()" ng-hide="isLoggedIn()">Login</button>
					
					<div id="loginSidePanel" class="login-side-panel">
						<a href="javascript:void(0)" class="closebtn" onclick="closeLogin()">&times;</a>
						
						<div class="login-form-header col-11">
							<p>NVIP Login</p>
						</div>
						
						<form class="col-11" name="form" ng-submit="login()" role="form">
						    <div class="form-group col-12">
						        <label for="username">Username</label>
						        <i class="fa fa-key"></i>
						        <input type="text" name="username" id="username" class="form-control" ng-model="credentials.username" required />
						        <span ng-show="form.username.$dirty && form.username.$error.required" class="help-block">Username is required</span>
						    </div>
						    <div class="form-group col-12">
						        <label for="password">Password</label>
						        <i class="fa fa-lock"></i>
						        <input type="password" name="password" id="password" class="form-control" ng-model="credentials.password" required />
						        <span ng-show="form.password.$dirty && form.password.$error.required" class="help-block">Password is required</span>
						    </div>
						    <div class="form-actions col-12">
						        <button class="login-submit-button btn btn-danger" type="submit" ng-disabled="form.$invalid || dataLoading">Login</button>
						        <img ng-if="dataLoading" src="data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwkJCQgAAAGJiYoKCgpKSkiH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQJCgAAACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkECQoAAAAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkECQoAAAAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkECQoAAAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQJCgAAACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQJCgAAACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAkKAAAALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA=="/>
						        <br>
						        <br>
						        <a style="float:right" href="#/createaccount">Create NVIP Account</a>
						    </div>
						    <div class="col-10"><font style="font-size: 10pt"><p style="color:red">Username=demo, Password=demo</font></div>
						</form>
						
					</div>
						
				</div>
			
			</div>
		 </div>`
			 
	 };
});

function switchViewToAdmin(show, $timeout) { 
	
	$timeout(function () {
	    //DOM has finished rendering
		var userView = document.getElementById("userView"); 
		var adminView = document.getElementById("adminView");
		
		if (userView == null || adminView==null){
			console.log('No header');
			return;
		}
			
		if (show){
			userView.style.display = "none"; 
			adminView.style.display = "flex";
		}
		else{
			userView.style.display = "flex"; 
			adminView.style.display = "none";
		}
	}, 500);
}

function openLogin() {
	document.getElementById("loginSidePanel").style.width = "350px";
}

function closeLogin() {
	document.getElementById("loginSidePanel").style.width = "0";
	document.getElementById("loginSidePanel").style.marginRight = "0";
}