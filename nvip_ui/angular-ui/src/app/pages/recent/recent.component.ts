import { Component, OnInit } from '@angular/core';
import { faSpinner } from '@fortawesome/free-solid-svg-icons';
import { VulnService } from 'src/app/services/vuln/vuln.service';

export interface VulnMap {
  date: string;
  cve_list: Array<any>;
}

export interface VulnMaps extends Array<VulnMap> {}

@Component({
  selector: 'nvip-recent',
  templateUrl: './recent.component.html',
  styleUrls: ['./recent.component.css'],
})
export class RecentComponent implements OnInit {
  // TODO populate with response from vulnerabilityServlet
  faSpinner = faSpinner;
  dailyVulnLimit = [];
  vulnLimitIncr: number = 5;
  dailyVulnIndex: number = 0;
  dailyVulns: VulnMaps = [];

  constructor(private vulnService: VulnService) {}

  ngOnInit() {
    this.vulnService.onRecentInit().subscribe((res: any) =>
      Object.keys(res).forEach((key) => {
        this.dailyVulns.push({
          date: this.formatDate(res[key].date),
          cve_list: res[key].list,
        });
      })
    );
  }

  formatDate(dateString: string) {
    var timeZone = 'T00:00:00.000-08:00';
    var date = new Date(dateString + timeZone);
    var today = new Date();

    return date.toDateString();
  }

  //todo change vulnMap any
  isDisabled(isMore: boolean, panelIndex: number, vulnMap: any) {
    if (isMore)
      return this.dailyVulnLimit[panelIndex] >= vulnMap.cve_list.length;
    else return this.dailyVulnLimit[panelIndex] <= this.vulnLimitIncr;
  }

  getDailyVulns() {}

  incrementDailyVulnDay(incr: number) {
    if (this.dailyVulnIndex + incr < 0) {
      return;
    } else if (this.dailyVulnIndex + incr >= this.dailyVulns.length) {
      return;
    }

    this.dailyVulnIndex = this.dailyVulnIndex += incr;
  }

  //TODO ensure only 5 VULNS show

  //TODO
  showMore(panelIndex: number) {
    console.log('this should show more');
    // this.dailyVulnLimit[panelIndex] = this.dailyVulnLimit[panelIndex] + this.vulnLimitIncr;
  }

  //TODO
  showLess(panelIndex: number) {
    console.log('this should show less');

    // newLimit = $scope.dailyVulnLimit[panelIndex] - $scope.vulnLimitIncr;

    // if (newLimit < $scope.vulnLimitIncr) {
    //   $scope.dailyVulnLimit[panelIndex] = $scope.vulnLimitIncr;
    // } else {
    //   $scope.dailyVulnLimit[panelIndex] = newLimit;
    // }
  }
}
